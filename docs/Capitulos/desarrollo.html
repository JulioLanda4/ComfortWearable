<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Desarrollo, construcción y validación – Reloj inteligente IoT basado en tecnologías abiertas para la recopilación de datos de confort térmico</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../Capitulos/resultados.html" rel="next">
<link href="../Capitulos/confort_termico.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2486e1f0a3ee9ee1fc393803a1361cdb.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-226331c9e834ac44cee568012f28a6e5.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Sin resultados",
    "search-matching-documents-text": "documentos encontrados",
    "search-copy-link-title": "Copiar el enlace en la búsqueda",
    "search-hide-matches-text": "Ocultar resultados adicionales",
    "search-more-match-text": "resultado adicional en este documento",
    "search-more-matches-text": "resultados adicionales en este documento",
    "search-clear-button-title": "Borrar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Buscar"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script type="application/json" class="js-hypothesis-config">
{
  "theme": "clean"
}
</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Capitulos/desarrollo.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Desarrollo, construcción y validación</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Buscar" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Reloj inteligente IoT basado en tecnologías abiertas para la recopilación de datos de confort térmico</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Buscar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Resumen</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capitulos/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introducción</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capitulos/confort_termico.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Marco teórico</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capitulos/desarrollo.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Desarrollo, construcción y validación</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capitulos/resultados.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Conclusiones</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Capitulos/references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Referencias</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Tabla de contenidos</h2>
   
  <ul>
  <li><a href="#sec-metodología" id="toc-sec-metodología" class="nav-link active" data-scroll-target="#sec-metodología"><span class="header-section-number">3.1</span> Metodología</a></li>
  <li><a href="#sec-construccion" id="toc-sec-construccion" class="nav-link" data-scroll-target="#sec-construccion"><span class="header-section-number">3.2</span> Construcción del dispositivo</a></li>
  <li><a href="#sec-encuestas" id="toc-sec-encuestas" class="nav-link" data-scroll-target="#sec-encuestas"><span class="header-section-number">3.3</span> Encuestas e interfaz</a></li>
  <li><a href="#sec-calibración" id="toc-sec-calibración" class="nav-link" data-scroll-target="#sec-calibración"><span class="header-section-number">3.4</span> Calibración</a>
  <ul class="collapse">
  <li><a href="#calibración-del-sensor-max30102" id="toc-calibración-del-sensor-max30102" class="nav-link" data-scroll-target="#calibración-del-sensor-max30102"><span class="header-section-number">3.4.1</span> Calibración del Sensor MAX30102</a></li>
  <li><a href="#calibración-del-sensor-gy-906" id="toc-calibración-del-sensor-gy-906" class="nav-link" data-scroll-target="#calibración-del-sensor-gy-906"><span class="header-section-number">3.4.2</span> Calibración del Sensor GY-906</a></li>
  </ul></li>
  <li><a href="#sec-programación" id="toc-sec-programación" class="nav-link" data-scroll-target="#sec-programación"><span class="header-section-number">3.5</span> Lógica de programación</a></li>
  <li><a href="#sec-instrucciones" id="toc-sec-instrucciones" class="nav-link" data-scroll-target="#sec-instrucciones"><span class="header-section-number">3.6</span> Instrucciones de uso</a></li>
  <li><a href="#sec-validación" id="toc-sec-validación" class="nav-link" data-scroll-target="#sec-validación"><span class="header-section-number">3.7</span> Validación</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Desarrollo, construcción y validación</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>En esta sección se describe el proceso completo de desarrollo, construcción y validación del dispositivo presentado en esta tesis. La <a href="#sec-metodología" class="quarto-xref"><span>Sección 3.1</span></a> aborda la metodología general del proyecto, incluyendo una descripción detallada del dispositivo, la selección de los componentes y la justificación de su elección. En la <a href="#sec-construccion" class="quarto-xref"><span>Sección 3.2</span></a> se desarrolla la etapa de diseño y construcción del dispositivo. La <a href="#sec-encuestas" class="quarto-xref"><span>Sección 3.3</span></a> se centra en el diseño y la implementación de las encuestas mediante la interfaz gráfica, mientras que la <a href="#sec-calibración" class="quarto-xref"><span>Sección 3.4</span></a> detalla el proceso de calibración de los sensores, para asegurar fiabilidad en las mediciones. En la <a href="#sec-programación" class="quarto-xref"><span>Sección 3.5</span></a> se presenta la lógica de programación del dispositivo, y en la <a href="#sec-instrucciones" class="quarto-xref"><span>Sección 3.6</span></a> se proporcionan instrucciones de uso. Finalmente, en la <a href="#sec-validación" class="quarto-xref"><span>Sección 3.7</span></a> comprueba la funcionalidad del dispositivo para recopilar y almacenar información de confort térmico.</p>
<section id="sec-metodología" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="sec-metodología"><span class="header-section-number">3.1</span> Metodología</h2>
<ol type="1">
<li><strong>Descripción general del dispositivo:</strong></li>
</ol>
<p>El dispositivo presentado en esta tesis es un prototipo de reloj inteligente diseñado específicamente para la investigación en el ámbito del confort térmico. Este dispositivo permite la recopilación de datos fisiológicos, tales como la frecuencia cardíaca y la temperatura de la piel, variables cuya relación con el confort térmico se discutió en el capítulo anterior. Además, este dispositivo realiza encuestas periódicas simplificadas de confort térmico mediante una interfaz de usuario intuitiva, que permite responder la encuesta de forma rápida y sencilla. La recopilación de estos datos se realiza en la plataforma de IoT llamada ThingsBoard, lo que permite la creación de una base de datos de confort térmico en un bioclima cálido semihúmedo <span class="citation" data-cites="infonavit2024regiones">(<a href="references.html#ref-infonavit2024regiones" role="doc-biblioref">Infonavit 2024</a>)</span> en Temixco, Morelos. Esta base de datos facilitará estudios para el entendimiento del confort térmico y el desarrollo de modelos de confort para este tipo de bioclima, así como de modelos de confort personalizados.</p>
<ol start="2" type="1">
<li><strong>Selección de componentes</strong></li>
</ol>
<p>Para garantizar el funcionamiento preciso y adecuado del dispositivo, es fundamental seleccionar correctamente todos los componentes. A continuación se describen los principales componentes utilizados, junto con sus características y la justificación de su elección en el proyecto. Esta justificación se basa en criterios como compatibilidad, consumo energético, precisión y capacidad de procesamiento en el caso del microcontrolador.</p>
<p>Los componentes principales son los siguientes:</p>
<ul>
<li>Placa de desarrollo</li>
<li>Pantalla</li>
<li>Batería</li>
<li>Sensores</li>
</ul>
<p><strong>Placa de desarrollo</strong></p>
<p>La selección de la tarjeta o placa de desarrollo es una decisión crucial en el desarrollo del proyecto. Se requiere una placa de tamaño reducido que cumpla con características esenciales como conexión WiFi, velocidad de procesamiento, memoria y comunicación I2C. Además, debe tener un bajo consumo energético para garantizar el uso portátil prolongado del dispositivo.</p>
<p>Se buscan placas compactas con conectividad inalámbrica. Opciones con microcontroladores como los de Arduino, ESP y Raspberry ofrecen estas características.</p>
<p>Durante el proceso de selección se identifican dos placas con pantallas integradas, que aunque podrían ser útiles, no cumplen con los requisitos del proyecto. La placa LILYGO TTGO, no cuenta con tecnología táctil, lo cual limita su utilidad para realizar encuestas de confort térmico. Por otro lado, la MCU RP2040 con LCD redondo de 1.28 pulgadas, aunque cuenta con una pantalla táctil, no ofrece conectividad WiFi, un requisito esencial. Aunque estas dos placas no son tomadas en cuanta por las razones ya mencionadas, sirven como referencia para la búsqueda de otras opciones. En la tabla <a href="#tbl-placas" class="quarto-xref">Tabla&nbsp;<span>3.1</span></a> se presenta una comparación de diferentes placas de desarrollo con las características requeridas.</p>
<div id="tbl-placas" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-placas-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;3.1: Comparación de características de conectividad y hardware en placas de desarrollo
</figcaption>
<div aria-describedby="tbl-placas-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 5%">
<col style="width: 10%">
<col style="width: 30%">
<col style="width: 12%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th>Placa de desarrollo</th>
<th>Wifi</th>
<th>Bluetooth</th>
<th>Comunicación</th>
<th>Cable</th>
<th>Pines</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Arduino Nano 33 IoT</td>
<td>si</td>
<td>4.2</td>
<td>SPI, I2C, I2S, UART</td>
<td>Micro USB</td>
<td>30 GPIOS, 8 ADC</td>
</tr>
<tr class="even">
<td>Arduino nano esp32</td>
<td>si</td>
<td>LE</td>
<td>UART, I2C, SPI, I2S, CAN(TWAI)</td>
<td>USB C</td>
<td>22 GPIOS, 8 ADC</td>
</tr>
<tr class="odd">
<td>Arduino nano RP2040 connect</td>
<td>si</td>
<td>si</td>
<td>STI, I2C, I2S, PIO, UART</td>
<td>USB C</td>
<td>30 GPIOS, 8 ADC</td>
</tr>
<tr class="even">
<td>Raspberry pi pico W</td>
<td>si</td>
<td>5.2</td>
<td>UART, I2C, SPI</td>
<td>Micro USB</td>
<td>26 GPIOS, 3 ADC</td>
</tr>
<tr class="odd">
<td>ESP32 pico kit</td>
<td>si</td>
<td>si</td>
<td>I2C, I2S, SPI</td>
<td>Micro USB</td>
<td>34 GPIOS</td>
</tr>
<tr class="even">
<td>Seeed Studio XIAO ESP32C3</td>
<td>si</td>
<td>5</td>
<td>1x UART, 1x IIC, 1x SPI</td>
<td>USB C</td>
<td>11 GPIOS, 4 ADC</td>
</tr>
<tr class="odd">
<td>Seeed Studio XIAO ESP32S3</td>
<td>si</td>
<td>5</td>
<td>1x UART, 1x IIC, 1x SPI</td>
<td>USB C</td>
<td>11 GPIOS, 9 ADC</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Si bien todas las placas presentadas son opciones viables, Seeed Studio ha desarrollado placas orientadas a aplicaciones de dispositivos portátiles. Estas placas empatan perfectamente con las necesidades del proyecto debido a su tamaño compacto, conectividad, modos de bajo consumo y la posibilidad de la integración con una pantalla táctil desarrollada por la misma marca. Para el desarrollo del proyecto, se elige la XIAO ESP32C3 sobre la XIAO ESP32S3. Aunque la primera es menos potente, cumple con todos los requerimientos a un menor costo. No obstante, la XIAO ESP32S3 podría ser usada sin ningún problema, ofreciendo incluso aumentar considerablemente la capacidad de memoria para futuras modificaciones o mejoras en el código. La <a href="#tbl-esp" class="quarto-xref">Tabla&nbsp;<span>3.2</span></a> muestra las características especificas de la placa seleccionada.</p>
<div id="tbl-esp" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-esp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;3.2: Especificaciones técnicas detalladas de la placa XIAO ESP32C3
</figcaption>
<div aria-describedby="tbl-esp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 60%">
<col style="width: 39%">
</colgroup>
<thead>
<tr class="header">
<th>Parametro</th>
<th>Seeed Studio XIAO ESP32C3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Procesador</td>
<td>ESP32-C3 32 bit<br>RISC-V<br>160 MHz</td>
</tr>
<tr class="even">
<td>Conectividad</td>
<td>2.4 GHz WiFi<br>BLE: Bluetooth 5.0, Bluetooth mesh</td>
</tr>
<tr class="odd">
<td>On-chip Memory</td>
<td>400 KB SRAM &amp; 4 MB Flash</td>
</tr>
<tr class="even">
<td>Interfaz</td>
<td>1x UART, 1x IIC, 1x SPI,<br>11x GPIO(PWM), 4x ADC, 1x Reset button, 1x Boot button</td>
</tr>
<tr class="odd">
<td>Dimensiones</td>
<td>21 x 17.8 mm</td>
</tr>
<tr class="even">
<td>Características eléctricas</td>
<td>Voltaje de entrada (Typo-C): 5 V<br>Voltaje de operación 3.3 V</td>
</tr>
<tr class="odd">
<td></td>
<td>Circuit operating Voltage (ready to operate):<br>- Type-C: 5 V@19mA <br>- BAT: 3.8 V@22mA</td>
</tr>
<tr class="even">
<td></td>
<td>corriente de carga de bateria: 350 mA/100 mA</td>
</tr>
<tr class="odd">
<td>Modo de bajo consumo</td>
<td>Modo deep-sleep: &gt; 44 µA</td>
</tr>
<tr class="even">
<td>WiFi activado Consumo de energía</td>
<td>Modo activo: &lt; 75 mA</td>
</tr>
<tr class="odd">
<td>Bluetooth activado Consumo de energía</td>
<td>Modo modem-sleep: &lt; 27 mA</td>
</tr>
<tr class="even">
<td>Temperatura de trabajo</td>
<td>-40 °C ~ 85 °C</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p><strong>Pantalla</strong></p>
<p>La elección de la pantalla debe alinearse con los criterios establecidos para la placa de desarrollo. se busca una pantalla que ademas de ser de tamaño reducido, sea compatible con la placa seleccionada. En la tabla <a href="#tbl-screen" class="quarto-xref">Tabla&nbsp;<span>3.3</span></a>, se presentan las características básicas de las pantallas consideradas durante el proceso.</p>
<div id="tbl-screen" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-screen-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;3.3: Comparacion de pantallas compatibles con la XIAO ESP32C3
</figcaption>
<div aria-describedby="tbl-screen-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 55%">
<col style="width: 16%">
<col style="width: 15%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th>Pantalla</th>
<th>touchscreen</th>
<th>tecnología</th>
<th>dimensión</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Seeed Studio Round Display for XIAO</td>
<td>si</td>
<td>TFT LCD</td>
<td>1.28’’</td>
</tr>
<tr class="even">
<td>Waveshare Módulo de visualización</td>
<td>no</td>
<td>OLED RGB</td>
<td>1.5’’</td>
</tr>
<tr class="odd">
<td>GC9A01 Pantalla</td>
<td>no</td>
<td>TFT LCD</td>
<td>1.28’’</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>La pantalla seleccionada es la Seeed Studio Round Display for XIAO. Este modelo es perfectamente compatible con la placa XIAO ESP32C3, elegida previamente, gracias al enfoque de Seeed Studio para desarrollar un ecosistema orientado a aplicaciones de dispositivos portátiles. La compatibilidad entre los componentes, tecnología táctil y diseño redondo, logran que la pantalla se ajuste a las necesidades del proyecto.</p>
<p><strong>Sensor de temperatura</strong></p>
<p>La <a href="#tbl-temp" class="quarto-xref">Tabla&nbsp;<span>3.4</span></a> muestra una comparación entre distintos sensores de temperatura que podrían ser utilizados en el proyecto, incluyendo termistores, sensores infrarrojos y un sensor de temperatura y humedad. Estos sensores se manejan en un rango de operación entre los 3.3 V y 5.0 V para garantizar su compatibilidad con la placa de desarrollo seleccionada.</p>
<div id="tbl-temp" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-temp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;3.4: Comparación de Sensores de Temperatura por Rango Operativo y Precisión
</figcaption>
<div aria-describedby="tbl-temp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 15%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 21%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th>Característica</th>
<th>Tipo de sensor</th>
<th>Rango de temperatura</th>
<th>Precisión</th>
<th>Comunicación</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>GY-906 (MLX90614)</strong></td>
<td>Sensor de temperatura infrarrojo</td>
<td>-70°C a 382.2°C</td>
<td>±0.5°C (0°C a 50°C)</td>
<td>I2C</td>
</tr>
<tr class="even">
<td><strong>ZTP-115M</strong></td>
<td>Sensor de temperatura infrarrojo</td>
<td>-20°C a 100°C</td>
<td>±1°C (32°C a 42°C)</td>
<td>Salida analógica</td>
</tr>
<tr class="odd">
<td><strong>NTC MF52AT</strong></td>
<td>Termistor NTC</td>
<td>-55°C a 125°C</td>
<td>±0.2°C (dependiendo de la resistencia)</td>
<td>Ninguna (sensor resistivo)</td>
</tr>
<tr class="even">
<td><strong>BetaTherm 10K3A1</strong></td>
<td>Termistor NTC</td>
<td>-50°C a 150°C</td>
<td>±0.2°C (25°C a 45°C)</td>
<td>Ninguna (sensor resistivo)</td>
</tr>
<tr class="odd">
<td><strong>AHT20</strong></td>
<td>Sensor de temperatura y humedad digital</td>
<td>-40°C a 85°C</td>
<td>±0.3°C (temperatura) / ±2% HR (humedad)</td>
<td>I2C</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Tras un análisis detallado, se selecciona el sensor GY-906 debido a su tamaño compacto, diseño adecuado y comunicación digital por I2C. Aunque el termistor NTC MF52AT ofrece una alternativa viable, se descarta por ser un sensor analógico. Dado que el dispositivo está diseñado para operar en un espacio reducido, cualquier interferencia en las conexiones internas podría afectar la precisión de los sensores analógicos. Por esta razón, se opta por el GY-906, que garantiza una transmisión de datos confiable y estable en entornos compactos.</p>
<p><strong>Sensor de pulso cardíaco</strong></p>
<p>Los sensores ópticos se han consolidado como una buena opción para la medición de la frecuencia cardíaca en dispositivos portátiles. Maxim Integrated ofrece la línea de sensores MAX3010X para este tipo de aplicaciones. Estos sensores destacan por su bajo consumo de energía, precio accesible, tamaño compacto y protocolo de comunicación I2C. La <a href="#tbl-pulso" class="quarto-xref">Tabla&nbsp;<span>3.5</span></a> muestra una comparación entre los sensores MAX20100, MAX30102 y MAX30105.</p>
<div id="tbl-pulso" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-pulso-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;3.5: Comparación de Sensores de frecuencia cardíaca
</figcaption>
<div aria-describedby="tbl-pulso-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 21%">
<col style="width: 7%">
<col style="width: 28%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Sensor</strong></th>
<th><strong>Tipo de almacenamiento</strong></th>
<th><strong>Resolución ADC</strong></th>
<th><strong>Funcionalidades</strong></th>
<th><strong>Consumo de Energía</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>MAX30100</strong></td>
<td>16-bit FIFO</td>
<td>14-bit</td>
<td>Frecuencia cardíaca y SpO2</td>
<td>600 µA a 1 mA</td>
</tr>
<tr class="even">
<td><strong>MAX30102</strong></td>
<td>32-bit FIFO</td>
<td>18-bit</td>
<td>Frecuencia cardíaca, SpO2</td>
<td>600 µA a 1.2 mA</td>
</tr>
<tr class="odd">
<td><strong>MAX30105</strong></td>
<td>32-bit FIFO</td>
<td>18-bit</td>
<td>Frecuencia cardíaca, SpO2, detección de partículas</td>
<td>600 µA a 1.2 mA</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>El MAX30102 se elige como la mejor opción para este proyecto por su equilibrio entre funcionalidad, costo y tamaño. A comparación del MAX30105, este es más económico y más compacto. La funcionalidad de detección de partículas no es de interés para este proyecto. Además, el MAX30102 ofrece mejoras significativas respecto al MAX30100, tanto en la resolución como en el tipo de almacenamiento. La medición de oxigenación en la sangre no es una característica actual del dispositivo planteado en esta tesis, pero podría ser una variable de interés en investigaciones futuras.</p>
<p><strong>Circuito vibrador</strong></p>
<p>El dispositivo cuenta con un sistema de alarma silenciosa compuesta por un motor vibrador circular de 8 mm de diámetro, alimentado a 3.7 V y un circuito de control. La <a href="#fig-circuito_motor" class="quarto-xref">Figura&nbsp;<span>3.1</span></a> muestra este circuito.</p>
<div id="fig-circuito_motor" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-circuito_motor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../Imagenes/Circuito_motor.png" class="img-fluid figure-img" style="width:50.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-circuito_motor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.1: Circuito de control del motor vibrador
</figcaption>
</figure>
</div>
<p><strong>Batería</strong></p>
<p>El uso de baterías de polímero de litio (LiPo) es ampliamente utilizado en dispositivos portátiles debido a sus características de pequeño tamaño, bajo peso y facilidad de carga. Para este proyecto, que integra una placa de desarrollo XIAO ESP32C3, una pantalla XIAO Round Display, un sensor GY-906, un sensor MAX30102 y un circuito vibrador, es crucial seleccionar una capacidad de batería que asegure un funcionamiento continuo y confiable, considerando el consumo energético de cada componente involucrado.</p>
<p>La XIAO ESP32C3 presenta un consumo promedio de 74.7 mA durante su operación activa <span class="citation" data-cites="xiaoesp32c3">(<a href="references.html#ref-xiaoesp32c3" role="doc-biblioref">Studio 2024</a>)</span>, mientras que la pantalla XIAO Round Display demanda aproximadamente 70.0 mA <span class="citation" data-cites="xiaodisplay">(<a href="references.html#ref-xiaodisplay" role="doc-biblioref">Solution 2024</a>)</span>. Por su parte, el sensor GY-906 tiene un consumo de corriente bajo, en el rango de 1.0 a 2.0 mA <span class="citation" data-cites="mlx90614_datasheet">(<a href="references.html#ref-mlx90614_datasheet" role="doc-biblioref">Melexis 2009</a>)</span>, el sensor MAX30102 consume entre 0.6 y 1.2 mA durante la medición de la frecuencia cardíaca <span class="citation" data-cites="max30102_datasheet">(<a href="references.html#ref-max30102_datasheet" role="doc-biblioref">Integrated 2015</a>)</span>. Adicionalmente, el motor vibrador registra un consumo estimado de 84.0 mA <span class="citation" data-cites="uelectronics_vibration_motor">(<a href="references.html#ref-uelectronics_vibration_motor" role="doc-biblioref">uElectronics 2024</a>)</span>, dependiendo de la intensidad de la vibración y la carga aplicada.</p>
<p>El consumo total del dispositivo en condiciones de operación máxima puede alcanzar 232.0 mA. Sin embargo, este nivel de consumo es poco probable alcanzarse durante el uso típico del dispositivo,ya que, durante la mayor parte del tiempo los sensores y la pantalla permanecen inactivos y solo se encenderan al momento de llevar a cabo sus mediciones; el motor vibrador se enciende únicamente por breves periodos cada hora. Con el fin de asegurar autonomía del dispositivo y evitar interrupciones en su funcionamiento, se selecciona una batería de 650.0 mAh. Este capacidad satisface los requisitos energéticos, permitiendo el uso prolongado del dispositivo. Además, la batería seleccionada cumple en tamaño y peso, ajustándose adecuadamente al diseño del dispositivo.</p>
<p>La <a href="#tbl-componentes-seleccionados" class="quarto-xref">Tabla&nbsp;<span>3.6</span></a> muestra todos los componentes seleccionados para el desarrollo del dispositivo.</p>
<div id="tbl-componentes-seleccionados" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-componentes-seleccionados-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;3.6: Tabla de componentes seleccionados
</figcaption>
<div aria-describedby="tbl-componentes-seleccionados-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 31%">
<col style="width: 68%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Componente</strong></th>
<th><strong>Descripción</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>XIAO ESP32C3</td>
<td>Placa de desarrollo compacta con Wi-Fi y BLE</td>
</tr>
<tr class="even">
<td>XIAO Round Display</td>
<td>Pantalla circular táctil de 1.28 pulgadas</td>
</tr>
<tr class="odd">
<td>GY-906</td>
<td>Sensor infrarrojo de temperatura sin contacto</td>
</tr>
<tr class="even">
<td>MAX30102</td>
<td>Sensor óptico de frecuencia cardíaca</td>
</tr>
<tr class="odd">
<td>Circuito vibrador</td>
<td>Circuito vibrador para notificaciones silenciosas</td>
</tr>
<tr class="even">
<td>Batería 650 mAh</td>
<td>Batería LiPo recargable</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<ol start="3" type="1">
<li><strong>Diseño del dispositivo</strong></li>
</ol>
<p>Una vez seleccionados los componentes principales del dispositivo, el diseño se centra en crear una carcasa compacta y adecuada en donde los componentes puedan colocarse sin interferir entre ellos y así mismo el desarrollo de los circuitos internos de conexión</p>
<p><strong>Carcasa:</strong></p>
<p>La carcasa del dispositivo esta diseñada para ser impresa en 3D y consta de tres partes principales y un seguro. La primera parte es la base y esta es la que está en contacto con la muñeca del usuario, cuenta con ranuras para el acomodo y fijación de los sensores y que estos queden en contacto directo con la piel para llevar a cabo las mediciones de forma adecuada</p>
<p>La parte central de la carcasa es la pieza que va arriba de la base y es donde se aloja el microcontrolador, el motor vibrador y el interruptor de encendido. La pieza está diseñada con compartimentos para fijar cada uno de estos componentes. Por la parte exterior de la carcasa, esta pieza cuenta con ranuras para colocar las correas que fijan el dispositivo a la muñeca del usuario.</p>
<p>La parte superior de la carcasa está diseñada con el fin de mantener la pantalla táctil en su posición y cerrar el dispositivo. Todas las piezas se ensamblan una con otra por presión, evitando el uso de tornillos.</p>
<p>Adicional, hay una cuarta pieza que es un seguro para fijar el interruptor de encendido. Esta se coloca por encima del interruptor una ve esté colocado en su posición en la pieza central. El seguro ensambla por presión a la pieza y deja fijo el interruptor.</p>
<p>En la <a href="#fig-partescase" class="quarto-xref">Figura&nbsp;<span>3.2</span></a> Se observan las tres piezas principales de la carcasa.</p>
<div id="fig-partescase" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-partescase-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../Imagenes/PartesCase.png" class="img-fluid figure-img" style="width:75.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-partescase-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.2: Diagrama de conexiones
</figcaption>
</figure>
</div>
<p><strong>Diseño de los circuitos</strong></p>
<p>El diseño de los circuitos se divide en tres circuitos, circuito vibrador para alarma <a href="#fig-conexiones" class="quarto-xref">Figura&nbsp;<span>3.3</span></a> a) , circuito de sensores y microcontrolador <a href="#fig-conexiones" class="quarto-xref">Figura&nbsp;<span>3.3</span></a> b) y el circuito de la batería <a href="#fig-conexiones" class="quarto-xref">Figura&nbsp;<span>3.3</span></a> c). Cada uno de estos circuitos está diseñado para mantener las conexiones lo más simples y cortas posibles. Dado que la placa XIAO ESP32C3 y la pantalla XIAO Round Display se ensamblan directamente, se omite ese circuito.</p>
<div id="fig-conexiones" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-conexiones-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../Imagenes/Diagrama de conexiones.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-conexiones-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.3: Diagrama de conexiones
</figcaption>
</figure>
</div>
<p>El código de colores utilizado en este proyecto, para facilitar las conexiones, es:</p>
<ul>
<li><strong><em>Rojo:</em></strong> Conexión Vcc (3.3 V).</li>
<li><strong><em>Negro:</em></strong> GND.</li>
<li><strong><em>Azul:</em></strong> cable de comunicación SCL.</li>
<li><strong><em>Blanco:</em></strong> cable de comunicación SDA.</li>
<li><strong><em>Verde:</em></strong> señal de activación del motor.</li>
<li><strong><em>Amarillo:</em></strong> conexión entre el pin emisor del transistor y el motor vibratorio.</li>
</ul>
<p>El circuito vibrador es un circuito sencillo de control de motor. su principal objetivo proteger el microcontrolador, evitando que el motor se alimente directamente desde el pin digital del microcontrolador, si no que lo haga directamente de la fuente de alimentación general del dispositivo, mientras que el pin del microcontrolador se utiliza únicamente para enviar la señal de activación.</p>
<p>El circuito que conecta los sensores con el microcontrolador tiene como propósito establecer la comunicación simultánea de ambos sensores mediante el protocolo I2C.</p>
<p>El circuito de la batería integra un interruptor de encendido y apagado, que permite al usuario controlar la alimentación del dispositivo; y un conector JST, que proporciona la conexión directa con la pantalla táctil XIAO Round Display.</p>
<p>Finalmente, en la <a href="#fig-DiagramaBloques" class="quarto-xref">Figura&nbsp;<span>3.4</span></a> se ilustra la organización de los distintos componentes del dispositivo, haciendo una separación entre los elementos internos y externos del reloj. Los componentes dentro del recuadro negro son aquellos que están contenidos físicamente dentro de la carcasa del reloj, como los sensores, la batería, la antena WIFI, el circuito de la pantalla, el circuito vibrador y el microcontrolador. Por otro lado, los elementos que se encuentran fuera del recuadro negro corresponden a los componentes externos con los cuales el usuario interactúa directamente, como el interruptor de encendido y apagado, la pantalla táctil y el puerto de carga USB-C. Además, el diagrama indica las interconexiones entre los diferentes componentes con líneas. Se destaca que la conexión entre los sensores y el microcontrolador es mediante el protocolo I2C.</p>
<div id="fig-DiagramaBloques" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-DiagramaBloques-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../Imagenes/DiagramaBloques.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-DiagramaBloques-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.4: Diagrama de bloques
</figcaption>
</figure>
</div>
</section>
<section id="sec-construccion" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="sec-construccion"><span class="header-section-number">3.2</span> Construcción del dispositivo</h2>
<p>La construcción del dispositivo en tres etapas: La impresión de la carcasa, la conexión de los componentes electrónicos y la integración y montaje de todos los elementos.</p>
<p><strong><em>Carcasa:</em></strong> los archivos STL para la impresión de la carcasa los puedes encontrar en el <a href="https://github.com/JulioLanda4/Reloj_Confort" target="_blank">repositorio del proyecto</a></p>
<p><strong><em>Componentes electrónicos:</em></strong> Las conexiones de los componentes electrónicos se llevan a cabo siguiendo los diagramas de <a href="#fig-conexiones" class="quarto-xref">Figura&nbsp;<span>3.3</span></a>. Es importante seguir correctamente los diagramas para facilitar posteriormente su acomodo dentro de la carcasa.</p>
<p><strong><em>Integración y montaje:</em></strong> Una vez realizadas las conexiones, se lleva a cabo el montaje de los circuitos dentro de la carcasa, esta se ensambla y se colocan las correas.</p>
<p>En el articulo XXX puede encontrar información más detallada acerca del diseño y los pasos a seguir para la construcción del dispositivo.</p>
</section>
<section id="sec-encuestas" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="sec-encuestas"><span class="header-section-number">3.3</span> Encuestas e interfaz</h2>
<p>Una de las principales características del reloj inteligente presentado, es la capacidad de realizar encuestas de confort térmico de manera periódica y en condiciones reales con el propósito de recolectar datos que permitan estudiar la percepción de confort térmico en el Instituto de Energías Renovables (IER) de la UNAM. A continuación se describe la metodología de implementación de las encuestas, la lógica de la interfaz y las funcionalidades que permiten la interacción eficiente entre el usuario y el dispositivo.</p>
<ol type="1">
<li>Diseño de las Encuestas</li>
</ol>
<p>El reloj inteligente lleva a cabo encuestas simplificadas de confort térmico cada hora, en horarios específicos entre las 8:00 a.m. y las 9:00 p.m., programadas en las medias horas para alinearse con los horarios de actividades en el IER, permitiendo al usuario aclimatarse antes de responder la encuesta. Al llegar el momento de responder la encuesta, el dispositivo activa una alarma vibradora que consta de tres pulsos cortos en un lapso de un segundo, para notificar al usuario. Si el usuario ignora la alarma, el botón de ‘Encuesta’ permanece activo hasta que se complete la encuesta, si después de quince minutos la encuesta no ha sido respondida, la alarma se vuelve a activar una vez más. Si esta segunda notificación es ignorada, la alarma no se activa nuevamente hasta la próxima hora programada.</p>
<p>La encuesta consta de cinco preguntas. Las preguntas seleccionadas se basan en los lineamientos establecidos por la ISO 10551 (<span class="citation" data-cites="ISO10551">International Organization for Standardization (<a href="references.html#ref-ISO10551" role="doc-biblioref">2019</a>)</span>). Las cinco preguntas son las siguientes:</p>
<ul>
<li>Vestimenta: Presenta la pregunta: “¿Cuál es tu vestimenta actual?” donde el usuario puede seleccionar todas las prendas que este usando de una lista predefinida. El objetivo de esta pregunta es calcular el nivel de aislamiento térmico del usuario (CLO). La interfaz muestra el cálculo del valor de CLO en la parte inferior de la pantalla a medida que se seleccionan o deseleccionan las prendas. La <a href="#tbl-prendas" class="quarto-xref">Tabla&nbsp;<span>3.7</span></a> muestra la lista de prendas disponibles para seleccionar con su respectivo calor de CLO.</li>
</ul>
<div id="tbl-prendas" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-prendas-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;3.7: Tabla de equivalencia de prendas a CLO
</figcaption>
<div aria-describedby="tbl-prendas-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 26%">
<col style="width: 23%">
<col style="width: 26%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Prenda</strong></th>
<th><strong>Valor de CLO</strong></th>
<th><strong>Prenda</strong></th>
<th><strong>Valor de CLO</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Zapato</td>
<td>0.02</td>
<td>Shorts</td>
<td>0.06</td>
</tr>
<tr class="even">
<td>Calzón</td>
<td>0.04</td>
<td>Vestido</td>
<td>0.15</td>
</tr>
<tr class="odd">
<td>Playera</td>
<td>0.09</td>
<td>Pantalón de mezclilla</td>
<td>0.23</td>
</tr>
<tr class="even">
<td>Camisa</td>
<td>0.15</td>
<td>Abrigo</td>
<td>0.40</td>
</tr>
<tr class="odd">
<td>Pantalón</td>
<td>0.25</td>
<td>Gorro de lana</td>
<td>0.08</td>
</tr>
<tr class="even">
<td>Calcetines</td>
<td>0.02</td>
<td>Bata de baño</td>
<td>0.30</td>
</tr>
<tr class="odd">
<td>Sombrero</td>
<td>0.05</td>
<td>Chaleco</td>
<td>0.10</td>
</tr>
<tr class="even">
<td>Bufanda</td>
<td>0.10</td>
<td>Botas</td>
<td>0.10</td>
</tr>
<tr class="odd">
<td>Guantes</td>
<td>0.10</td>
<td>Impermeable</td>
<td>0.20</td>
</tr>
<tr class="even">
<td>Chaqueta</td>
<td>0.30</td>
<td>Sandalias</td>
<td>0.02</td>
</tr>
<tr class="odd">
<td>Suéter</td>
<td>0.18</td>
<td>Brasier</td>
<td>0.02</td>
</tr>
<tr class="even">
<td>Falda</td>
<td>0.14</td>
<td>Corpiño</td>
<td>0.03</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<ul>
<li>Actividad: Presenta la pregunta: “¿Qué actividad estás realizando?” donde el usuario selecciona una única opción de una lista predefinida de actividades que permiten calcular la tasa metabólica (MET) del usuario. La <a href="#tbl-actividad" class="quarto-xref">Tabla&nbsp;<span>3.8</span></a> muestra la lista de actividades con su respectivo valor de MET asociado.</li>
</ul>
<div id="tbl-actividad" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-actividad-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;3.8: Tabla equivalencia de actividades a MET
</figcaption>
<div aria-describedby="tbl-actividad-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th><strong>Actividad</strong></th>
<th><strong>Valor de MET</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Tomando clase sentado</td>
<td>1.3</td>
</tr>
<tr class="even">
<td>Tomando clase de pie</td>
<td>1.8</td>
</tr>
<tr class="odd">
<td>Dando clase sentado</td>
<td>2.0</td>
</tr>
<tr class="even">
<td>Dando clase de pie</td>
<td>2.3</td>
</tr>
<tr class="odd">
<td>Caminando</td>
<td>2.9</td>
</tr>
<tr class="even">
<td>Comiendo</td>
<td>1.5</td>
</tr>
<tr class="odd">
<td>Escribiendo</td>
<td>1.3</td>
</tr>
<tr class="even">
<td>Trabajando en computadora</td>
<td>1.5</td>
</tr>
<tr class="odd">
<td>De pie en un laboratorio</td>
<td>2.0</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<ul>
<li><p>Ubicación: Se presenta la pregunta: “¿Donde te encuentras?” donde el usuario selecciona una única opción de una lista predefinida de ubicaciones &nbsp;dentro del IER UNAM.</p></li>
<li><p>Escala de confort térmico: Se presenta la pregunta: “¿Cuál es tu sensación térmica en este momento?” donde el usuario puede elegir su sensación térmica actual en un rango de -3 a 3 en intervalos de 0.5. Cada valor tiene una descripción asociada de la sensación térmica. La <a href="#tbl-tsv" class="quarto-xref">Tabla&nbsp;<span>3.9</span></a> muestra la descripción asociada a cada uno de los valores del voto de sensación térmica.</p></li>
</ul>
<div id="tbl-tsv" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-tsv-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;3.9: Escala del voto de sensación térmica con su descripción
</figcaption>
<div aria-describedby="tbl-tsv-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th>Valor de Sensación Térmica</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>-3</td>
<td>Helado</td>
</tr>
<tr class="even">
<td>-2.5</td>
<td>Mucho frío</td>
</tr>
<tr class="odd">
<td>-2</td>
<td>Frío</td>
</tr>
<tr class="even">
<td>-1.5</td>
<td>Ligeramente frío</td>
</tr>
<tr class="odd">
<td>-1</td>
<td>Fresco</td>
</tr>
<tr class="even">
<td>-0.5</td>
<td>Ligeramente fresco</td>
</tr>
<tr class="odd">
<td>0</td>
<td>Neutro</td>
</tr>
<tr class="even">
<td>0.5</td>
<td>Ligeramente templado</td>
</tr>
<tr class="odd">
<td>1</td>
<td>Templado</td>
</tr>
<tr class="even">
<td>1.5</td>
<td>Ligeramente caluroso</td>
</tr>
<tr class="odd">
<td>2</td>
<td>Caluroso</td>
</tr>
<tr class="even">
<td>2.5</td>
<td>Muy caluroso</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Ardiendo</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<ul>
<li>Aceptación Térmica: Finalmente, se presenta la pregunta: “¿Aceptas la sensación térmica actual?”, donde el usuario puede responder “Sí” o “No”. Esta pregunta busca evaluar si, independientemente de la sensación térmica reportada, el usuario la percibe como aceptable.</li>
</ul>
<ol start="2" type="1">
<li>Interfaz de Usuario</li>
</ol>
<p>La interfaz del dispositivo ha sido diseñada utilizando la biblioteca LVGL, que ofrece herramientas para la creación de interfaces gráficas en microcontroladores integrados con pantallas táctiles. Cada una de las preguntas descritas previamente se presenta en una pantalla distinta, permitiendo al usuario navegar de manera intuitiva y sencilla.</p>
<ul>
<li><p>Navegación entre Pantallas: Cada pantalla tiene botones laterales para avanzar o retroceder entre las preguntas de la encuesta. Una vez completadas todas las preguntas, el usuario puede presionar el botón “Finalizar”.</p></li>
<li><p>Interacción con Pantallas: Cada pantalla que presenta una lista predefinida de opciones cuenta con botones para moverse entre las diferentes opciones disponibles. Esto permite al usuario seleccionar fácilmente la opción deseada, asegurando una interacción fluida y precisa con el dispositivo.</p></li>
</ul>
<ol start="3" type="1">
<li>Funcionalidades Adicionales y Validación</li>
</ol>
<p>Una vez que se completa la encuesta, al pulsar el botón “Finalizar”, aparece un mensaje emergente que solicita al usuario mantenerse inmóvil mientras que los sensores de frecuencia cardíaca (MAX30102) y de temperatura de la piel (GY-906) llevan a cabo sus mediciones correspondientes, estas mediciones se realizan en un lapso de diez segundos. Los resultados se muestran al usuario para su validación. Si el usuario considera que los resultados son coherentes, puede enviarlos; de lo contrario, tiene la opción de repetir las mediciones.</p>
<p>Los datos recolectados son enviados a la plataforma Thingsboard para su almacenamiento y análisis posterior. Esta funcionalidad permite construir una base de datos que facilite el estudio del confort térmico en diferentes espacios y condiciones dentro del IER.</p>
<p>La <a href="#fig-generica" class="quarto-xref">Figura&nbsp;<span>3.5</span></a> muestra todas las pantallas</p>
<div id="fig-generica" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-generica-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../Imagenes/ImagenGenerica.png" class="img-fluid figure-img" style="width:50.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-generica-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.5: Imagen generica
</figcaption>
</figure>
</div>
</section>
<section id="sec-calibración" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="sec-calibración"><span class="header-section-number">3.4</span> Calibración</h2>
<p>La calibración de los sensores en el dispositivo es esencial para garantizar la precisión y confiabilidad de las mediciones. Esta sección describe el proceso de calibración de los sensores MAX30102 y GY-906, utilizados para medir la frecuencia cardíaca y la temperatura de la piel, respectivamente.</p>
<section id="calibración-del-sensor-max30102" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="calibración-del-sensor-max30102"><span class="header-section-number">3.4.1</span> Calibración del Sensor MAX30102</h3>
<p>Para la calibración del sensor MAX30102, se utiliza como referencia un oxímetro de pulso Yonker YK-81C, que ofrece una precisión de ± 1 bpm. Dado que las mediciones del reloj inteligente se realizan en intervalos de 10 segundos, este mismo periodo se emplea durante el proceso de calibración. El sensor se configura mediante Arduino y la librería de SparkFun para los sensores MAX3010X. La calibración se enfoca en la configuración óptima de varios parámetros ajustables: <code>ledBrightness</code>, <code>sampleAverage</code>, <code>ledMode</code>, <code>sampleRate</code>, <code>pulseWidth</code>, <code>adcRange</code> y <code>RATE_SIZE</code>.</p>
<ul>
<li><strong>ledBrightness</strong> (0 - 255): Controla la intensidad de los LED infrarrojo y rojo, afectando la penetración de la luz en el tejido de la piel y, en consecuencia, la calidad de la señal obtenida. Un valor más alto aumenta la intensidad de la luz, mejorando la detección en condiciones de baja perfusión, pero incrementa el consumo de energía.</li>
<li><strong>sampleAverage</strong> (1, 2, 4, 8, 16, 32): Define cuántas muestras se promedian antes de almacenarse en la memoria FIFO. Un mayor promedio reduce el ruido y estabiliza la señal, a costa de reducir la capacidad de respuesta a cambios rápidos.</li>
<li><strong>ledMode</strong> (1 - 3): Establece el modo de operación del sensor. El valor 1 utiliza solo el LED rojo, el valor 2 emplea tanto el LED rojo como el infrarrojo para medir la frecuencia cardíaca y la saturación de oxígeno, y el valor 3 incluye un tercer LED verde en algunos modelos de la serie MAX3010X.</li>
<li><strong>sampleRate</strong> (50, 100, 200, 400, 800, 1000, 1600, 3200 Hz): Define la frecuencia con la que se toman las muestras de la señal, afectando la resolución temporal y la capacidad de captar variaciones rápidas en la frecuencia cardíaca. Una mayor frecuencia proporciona una mejor resolución temporal, pero puede aumentar el ruido si la señal no se filtra adecuadamente.</li>
<li><strong>pulseWidth</strong> (69, 118, 215, 411 µs): Controla la duración del pulso de luz emitido por los LED. Un mayor ancho de pulso mejora la resolución de las mediciones, pero también incrementa el consumo de energía del sensor y la cantidad de luz reflejada, lo cual puede saturar el ADC en ciertos tipos de piel.</li>
<li><strong>adcRange</strong> (2048, 4096, 8192, 16384 nA): Establece el rango de entrada del convertidor analógico-digital. Aumentar el rango permite al sensor manejar señales más intensas sin saturarse, mientras que un rango menor mejora la sensibilidad para señales débiles.</li>
<li><strong>RATE_SIZE</strong> (tamaño del buffer): Determina el tamaño del buffer para el cálculo de la frecuencia cardíaca. Este parámetro afecta la cantidad de datos utilizados para calcular la frecuencia cardíaca promedio. Aumentar el tamaño del buffer de 4 a 6 mejora la precisión de las lecturas, ya que permite una mayor estabilidad en los cálculos.</li>
</ul>
<p>Inicialmente, los parámetros se configuran con valores predeterminados, pero los resultados muestran un error absoluto medio (MAE) de 18.5 bpm respecto al oxímetro de referencia, lo cual no es aceptable. Para mejorar la precisión, se exploran valores extremos del parámetro <code>RATE_SIZE</code>, variando desde 1 hasta 100. Con <code>RATE_SIZE</code> igual a 1, se obtienen resultados rápidos pero poco precisos, mientras que con <code>RATE_SIZE</code> igual a 100, se logra alta precisión, pero se requieren múltiples intervalos de 10 segundos, incrementando el tiempo total de medición. Para encontrar un equilibrio entre precisión y tiempo de medición, se evalúan valores intermedios de <code>RATE_SIZE</code> entre 4 y 16. El valor óptimo encontrado es <code>RATE_SIZE</code> igual a 6, lo cual reduce el MAE a 4.4 bpm.</p>
<p>La <a href="#tbl-max30102" class="quarto-xref">Tabla&nbsp;<span>3.10</span></a> muestra el error absoluto medio (MAE) obtenido para diferentes valores de <code>RATE_SIZE</code> entre 4 y 16, destacando que el mejor valor para <code>RATE_SIZE</code> es 6:</p>
<div id="tbl-max30102" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-max30102-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;3.10: sdfsdfsd
</figcaption>
<div aria-describedby="tbl-max30102-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th>Número de Mediciones</th>
<th>RATE_SIZE</th>
<th>MAE (bpm)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>20</td>
<td>4</td>
<td>18.5</td>
</tr>
<tr class="even">
<td>20</td>
<td>6</td>
<td>4.4</td>
</tr>
<tr class="odd">
<td>20</td>
<td>8</td>
<td>12.0</td>
</tr>
<tr class="even">
<td>20</td>
<td>10</td>
<td>19.6</td>
</tr>
<tr class="odd">
<td>20</td>
<td>12</td>
<td>7.7</td>
</tr>
<tr class="even">
<td>20</td>
<td>14</td>
<td>13.6</td>
</tr>
<tr class="odd">
<td>20</td>
<td>16</td>
<td>15.8</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Posteriormente, con RATE_SIZE fijado en 6, se ajusta el valor de sampleAverage de 4 a 8, logrando un MAE de 3.6 bpm, lo cual representa una mejora en la estabilidad de la señal. La configuración final optimizada incluye los siguientes valores: ledBrightness en 31, sampleAverage en 8, ledMode en 2, sampleRate en 400, pulseWidth en 411, adcRange en 2048 y RATE_SIZE en 6.</p>
</section>
<section id="calibración-del-sensor-gy-906" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="calibración-del-sensor-gy-906"><span class="header-section-number">3.4.2</span> Calibración del Sensor GY-906</h3>
<p>Para la calibración del sensor de temperatura GY-906, se utiliza una cámara termográfica Fluke Ti9 como referencia. Tanto el sensor como la cámara se configuran con una emisividad de 0.98, correspondiente a la emisividad promedio de la piel humana. Las pruebas se realizan durante tres días, entre las 10:00 a. m. y las 06:00 p.&nbsp;m., con mediciones cada media hora para capturar diferentes condiciones ambientales.</p>
<p>Durante cada sesión de medición, el sensor GY-906 realiza diez mediciones consecutivas en un lapso de diez segundos, y el promedio de estas mediciones se envía a la plataforma Thingsboard, lo cual permite reducir el ruido y aumentar la precisión. Simultáneamente, las lecturas de la cámara termográfica se registran manualmente. Para minimizar el error por movimiento, el dispositivo emite una alerta vibratoria de un segundo, seguida de una pausa de cuatro segundos antes de realizar la medición, permitiendo al usuario mantener la mano inmóvil durante el proceso de medición. Se obtienen 61 pares de mediciones, la <a href="#tbl-estadisticas-camara" class="quarto-xref">Tabla&nbsp;<span>3.11</span></a> muestra las características estadísticas de ambos conjuntos de datos.</p>
<div id="tbl-estadisticas-camara" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-estadisticas-camara-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;3.11: Estadísticas de las Mediciones del Sensor GY-906 y la Cámara Termográfica Fluke Ti9
</figcaption>
<div aria-describedby="tbl-estadisticas-camara-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th>Estadística</th>
<th>Sensor (°C)</th>
<th>Cámara (°C)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Media</td>
<td>34.58</td>
<td>35.30</td>
</tr>
<tr class="even">
<td>Desviación estándar</td>
<td>0.75</td>
<td>0.63</td>
</tr>
<tr class="odd">
<td>Mínimo</td>
<td>32.36</td>
<td>32.80</td>
</tr>
<tr class="even">
<td>Máximo</td>
<td>35.83</td>
<td>35.83</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Se realiza un análisis inicial entre las mediciones de la cámara respecto al sensor y se obtienen los siguientes datos:</p>
<ul>
<li>Error Medio (EM): 0.72°C</li>
<li>Error Absoluto Medio (EAM): 0.77°C</li>
</ul>
<p>Dada la naturaleza de los datos, se aplica una calibración mediante un modelo de regresión lineal, obteniéndose los siguientes valores clave:</p>
<ul>
<li>Pendiente: 0.47</li>
<li>Intercepto: 18.99</li>
</ul>
<p>Una vez obtenidos estos valores, se aplica la función de regresión lineal sobre los datos del sensor para generar una nueva columna con datos corregidos. Al comparar esta nueva columna con las lecturas de la cámara, se obtiene un error estándar de la estimación <span class="math inline">\(S_e\)</span> de 0.54, mientras que los errores obtenidos son los siguientes:</p>
<ul>
<li>EM: 2.19x10<sup>-15</sup></li>
<li>EAM: 0.39</li>
</ul>
<p>La <a href="#fig-dispersion" class="quarto-xref">Figura&nbsp;<span>3.6</span></a> muestra la comparación entre las gráficas de dispersión de datos antes y después de la calibración.</p>
<div id="cell-fig-dispersion" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display">
<div id="fig-dispersion" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dispersion-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="desarrollo_files/figure-html/fig-dispersion-output-1.png" width="949" height="470" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dispersion-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.6: Gráficos de dispersión de las mediciones del sensor GY-906 y la cámara termográfica Fluke Ti9 antes y después de la calibración
</figcaption>
</figure>
</div>
</div>
</div>
<p>Posteriormente, se lleva a cabo una segunda campaña de medición, recopilando 25 pares de datos adicionales, con la finalidad de validar la función de regresión lineal obtenida. Juntando ambos conjuntos de datos, se obtiene un total de 86 pares de mediciones. Los errores iniciales de este conjunto son:</p>
<ul>
<li>EM: 0.59</li>
<li>EAM: 0.66</li>
</ul>
<p>Tras aplicar la función de regresión lineal, se obtiene un error estándar de la estimación <span class="math inline">\(S_e\)</span> de 0.54, lo cual demuestra la consistencia del valor entre el primer conjunto de datos y este nuevo conjunto, mientras que los errores son los siguientes:</p>
<ul>
<li>EM: -0.08</li>
<li>EAM: 0.41</li>
</ul>
<p>La <a href="#fig-dispersion2" class="quarto-xref">Figura&nbsp;<span>3.7</span></a> muestra la comparación de las gráficas de dispersión del conjunto total de datos (86 mediciones), antes y después de la calibración.</p>
<div id="cell-fig-dispersion2" class="cell" data-execution_count="2">
<div class="cell-output cell-output-display">
<div id="fig-dispersion2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dispersion2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="desarrollo_files/figure-html/fig-dispersion2-output-1.png" width="949" height="470" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dispersion2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.7: Gráficos de dispersión para validación de la calibración del Sensor GY-906.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Finalmente, la <a href="#tbl-errores-gy" class="quarto-xref">Tabla&nbsp;<span>3.12</span></a> muestra los EM y EAM antes y después de la calibración de los dos conjuntos de datos, el conjunto inicial a partir del cual se obtuvo la los parámetros para realizar el modelo de regresión lineal y el conjunto de validación en el cual se llevo a cabo una segunda campaña de medición para obtener más datos y verificar la fiabilidad de la calibración.</p>
<div id="tbl-errores-gy" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-errores-gy-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabla&nbsp;3.12: Tabla de errores promedio (ME) y errores absolutos medios (MAE) para el conjunto inicial y el conjunto de validación
</figcaption>
<div aria-describedby="tbl-errores-gy-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 15%">
<col style="width: 23%">
<col style="width: 15%">
<col style="width: 30%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Conjunto inicial</strong></th>
<th></th>
<th><strong>Conjunto de validación</strong></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td></td>
<td><strong>Sin calibrar</strong></td>
<td><strong>Calibrado</strong></td>
<td><strong>Sin calibrar</strong></td>
<td><strong>Calibrado</strong></td>
</tr>
<tr class="even">
<td><strong>ME</strong></td>
<td>0.5</td>
<td>0.89</td>
<td>0.65</td>
<td>-0.08</td>
</tr>
<tr class="odd">
<td><strong>MAE</strong></td>
<td>0.72</td>
<td>0.54</td>
<td>0.61</td>
<td>0.43</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
</section>
<section id="sec-programación" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="sec-programación"><span class="header-section-number">3.5</span> Lógica de programación</h2>
<p>A continuación, se describe el funcionamiento general del reloj inteligente, detallando la estructura del sistema y la función de cada uno de los archivos que componen el proyecto desarrollado en Arduino. También se presentan los diagramas de flujo de los procesos clave, como la función actualizar_hora y el procedimiento para responder una encuesta y medir las variables fisiológicas. Además, se destacan aspectos relevantes, como los horarios programados para las encuestas y las estrategias implementadas para el ahorro de energía.</p>
<p>El proyecto se desarrolla en Arduino, empleando principalmente la librería LVGL para el diseño de la interfaz gráfica. Está compuesto por varios archivos de código, cada uno con una función específica. A continuación, se ofrece una breve descripción de cada uno de ellos:</p>
<ol type="1">
<li><p><strong>Proyecto_confort.ino</strong>: Este es el archivo principal del proyecto. En él se ejecuta el código principal, se incluyen las librerías necesarias, y se declaran tanto las variables como las funciones esenciales.</p></li>
<li><p><strong>ui.c</strong> y <strong>ui.h</strong>: Estos archivos se encargan de la ejecución y configuración general de la interfaz gráfica. El archivo header (<strong>ui.h</strong>) contiene las declaraciones de funciones y variables utilizadas en <strong>ui.c</strong>.</p></li>
<li><p><strong>ui_Inicio.c</strong>: Configura la pantalla principal del reloj. En esta pantalla se muestra la hora actual, un contador regresivo que indica cuánto tiempo falta hasta el momento de contestar la siguiente encuesta, y el botón para iniciar la encuesta cuando está disponible.</p></li>
<li><p><strong>ui_Clo.c</strong>: Configura la pantalla para la pregunta sobre el nivel de aislamiento térmico de la ropa que usa el usuario. Este archivo contiene un diccionario con distintas prendas de ropa con sus respectivos valores de aislamiento térmico.</p></li>
<li><p><strong>ui_Met.c</strong>: Configura la pantalla para la pregunta sobre el nivel de actividad metabólica del usuario. Este archivo contiene un diccionario con diversas actividades y sus respectivos valores de nivel metabólico.</p></li>
<li><p><strong>ui_Ubicación.c</strong>: Configura la pantalla para la pregunta sobre la ubicación del usuario. Este archivo contiene una lista de ubicaciones del lugar donde se llevan a cabo las campañas de mediciones.</p></li>
<li><p><strong>ui_Sensacion.c</strong>: Configura la pantalla para la pregunta sobre el nivel de sensación térmica. Este archivo contiene un diccionario con la escala de sensación térmica, que va de -3 a 3, y la descripción correspondiente para cada nivel.</p></li>
<li><p><strong>ui_Aceptación.c</strong>: Configura la pantalla destinada a la pregunta de aceptación térmica.</p></li>
<li><p><strong>ui_events.c</strong> y <strong>ui_events.h</strong>: En <strong>ui_events.c</strong> Contienen todas las funciones creadas específicamente para el proyecto, tanto las relacionadas con la gestión de eventos generados por la interfaz como otras funciones generales del programa. El archivo de encabezado (<strong>ui_events.h</strong>) contiene las declaraciones de las funciones y variables utilizadas en <strong>ui_events.c</strong>.</p></li>
<li><p><strong>ui_helpers.c</strong> y <strong>ui_helpers.h</strong>: Contienen funciones auxiliares de la librería LVGL, diseñadas para facilitar la implementación y el manejo de la interfaz gráfica. El archivo header (<strong>ui_helpers-h</strong>) contiene las declaraciones de funciones y variables utilizadas en <strong>ui_helpers.c</strong>.</p></li>
</ol>
<p>El reloj está programado para realizar encuestas de confort térmico cada hora entre las 08:30 y las 21:30 horas. Programar las encuestas para realizarse en el minuto 30 de cada hora permite proporcionar al usuario un periodo de adaptación térmica previo a responder la primera encuesta. Esto se debe a que las actividades en el IER suelen iniciar en horas exactas, lo que asegura que los usuarios tengan tiempo suficiente para estabilizar su sensación térmica antes de contestar la primera encuesta.</p>
<p>La función denominada <strong>actualizar_hora</strong>, que se encuentra en el archivo <strong>ui_events.c</strong>, se encarga de actualizar la hora en pantalla, además habilita o desahibilita el botón para realizar la encuesta según el horario o si esta ya fue o no contestada. Esta función también es la encargada de emitir la alarma para alertar al usuario la disponibilidad de una nueva encuesta. El diagram de flujo de esta función se presenta en la <a href="#fig-actualizarhora" class="quarto-xref">Figura&nbsp;<span>3.8</span></a>.</p>
<div id="fig-actualizarhora" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-actualizarhora-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../Imagenes/Actualizar_hora.svg" class="img-fluid figure-img" style="width:50.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-actualizarhora-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.8: Diagrama de flujo de la función actualizar_hora
</figcaption>
</figure>
</div>
<p>Cuando el usuario presiona el botón para iniciar la encuesta, se da inicio a un proceso que consta de varias etapas: primero, el usuario responde a las preguntas de la encuesta; luego, se registran las variables fisiológicas; seguidamente, se validan las mediciones obtenidas; y, finalmente, se envían los datos a la plataforma Thingsboard.</p>
<p>Es importante destacar que, una vez enviada la encuesta, las respuestas y mediciones no se reinician automáticamente. Esto permite que, al iniciar una nueva encuesta, el reloj conserve las respuestas de la última encuesta realizada. De esta manera, el usuario puede optar por mantener las mismas respuestas o modificarlas según sea necesario. Esta funcionalidad tiene dos objetivos principales: en primer lugar, reducir el tiempo necesario para responder encuestas de manera consecutiva; y, en segundo lugar, permitir al usuario observar cómo evolucionan sus respuestas a lo largo del día.</p>
<p>En caso de que las mediciones de los sensores no sean aceptadas por el usuario, estas se realizan nuevamente. El diagrama de flujo que describe el proceso de la encuesta se presenta en la Figura <a href="#fig-iniciarencuesta" class="quarto-xref">Figura&nbsp;<span>3.9</span></a>.</p>
<p>Para optimizar el consumo de energía, se implementan dos estrategias principales. La primera consiste en mantener la pantalla del reloj apagada mientras el dispositivo está en reposo. Si la pantalla está encendida y no se detecta actividad durante más de 10 segundos, se apaga automáticamente. No obstante, el usuario puede reactivarla en cualquier momento con un simple toque para consultar la hora. La segunda estrategia consiste en mantener apagados el sensor de temperatura (GY-906) y el sensor de frecuencia cardiaca (MAX30102), activándose únicamente durante el proceso de medición de las variables fisiológicas.</p>
<div id="fig-iniciarencuesta" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-iniciarencuesta-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="../Imagenes/Iniciar_encuesta.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-iniciarencuesta-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3.9: Diagrama de flujo de encuesta y medición de variables
</figcaption>
</figure>
</div>
<p>En la siguiente sección (<a href="#sec-instrucciones" class="quarto-xref"><span>Sección 3.6</span></a>), se detallan las configuraciones iniciales necesarias para el funcionamiento del dispositivo, tales como la conexión a la red WiFi, la configuración del token del dispositivo y la configuración del servidor de Thingsboard.</p>
</section>
<section id="sec-instrucciones" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="sec-instrucciones"><span class="header-section-number">3.6</span> Instrucciones de uso</h2>
<ol type="1">
<li>Integración con la plataforma iot</li>
<li>manejo de los datos</li>
</ol>
</section>
<section id="sec-validación" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="sec-validación"><span class="header-section-number">3.7</span> Validación</h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-infonavit2024regiones" class="csl-entry" role="listitem">
Infonavit. 2024. <span>«Listado de Regiones Bioclimáticas»</span>. <a href="https://portalmx.infonavit.org.mx/wps/wcm/connect/005dcf74-d918-41aa-acfa-927e7b33d98a/12.%2BAnexo%252B1.%252BListado%252Bde%252Bregiones%252Bbioclim%25C3%25A1ticas.pdf?MOD=AJPERES&amp;CONVERT_TO=url&amp;CACHEID=ROOTWORKSPACE-005dcf74-d918-41aa-acfa-927e7b33d98a-mmCFC0">https://portalmx.infonavit.org.mx/wps/wcm/connect/005dcf74-d918-41aa-acfa-927e7b33d98a/12.%2BAnexo%252B1.%252BListado%252Bde%252Bregiones%252Bbioclim%25C3%25A1ticas.pdf?MOD=AJPERES&amp;CONVERT_TO=url&amp;CACHEID=ROOTWORKSPACE-005dcf74-d918-41aa-acfa-927e7b33d98a-mmCFC0</a>.
</div>
<div id="ref-max30102_datasheet" class="csl-entry" role="listitem">
Integrated, Maxim. 2015. <em>MAX30102 High-Sensitivity Pulse Oximeter and Heart-Rate Sensor for Wearable Health</em>. <a href="https://www.alldatasheet.com/datasheet-pdf/view/859400/MAXIM/MAX30102.html">https://www.alldatasheet.com/datasheet-pdf/view/859400/MAXIM/MAX30102.html</a>.
</div>
<div id="ref-ISO10551" class="csl-entry" role="listitem">
International Organization for Standardization. 2019. <span>«Ergonomics of the thermal environment – Assessment of the influence of the thermal environment using subjective judgement scales»</span>. ISO Standard 10551. <span>International Organization for Standardization</span>. <a href="https://www.iso.org/standard/45126.html">https://www.iso.org/standard/45126.html</a>.
</div>
<div id="ref-mlx90614_datasheet" class="csl-entry" role="listitem">
Melexis. 2009. <em>MLX90614 Infra Red Thermometer in TO-39</em>. <a href="https://www.melexis.com/en/documents/documentation/datasheets/mlx90614-datasheet">https://www.melexis.com/en/documents/documentation/datasheets/mlx90614-datasheet</a>.
</div>
<div id="ref-xiaodisplay" class="csl-entry" role="listitem">
Solution, ETA. 2024. <em>ETA6003 2.5A, 3MHz Switching Charger with Dynamic Power Path Management</em>. ETA Solution. <a href="https://files.seeedstudio.com/wiki/round_display_for_xiao/charge-IC-datasheet.pdf">https://files.seeedstudio.com/wiki/round_display_for_xiao/charge-IC-datasheet.pdf</a>.
</div>
<div id="ref-xiaoesp32c3" class="csl-entry" role="listitem">
Studio, Seeed. 2024. <span>«Seeed Studio XIAO ESP32C3 Development Board»</span>. <a href="https://www.seeedstudio.com/Seeed-XIAO-ESP32C3-p-5431.html?srsltid=AfmBOopHrrta3vMhxj9CZJasHKtro5S9tVjwzPT3-KtKiNUV8CeFVebb">https://www.seeedstudio.com/Seeed-XIAO-ESP32C3-p-5431.html?srsltid=AfmBOopHrrta3vMhxj9CZJasHKtro5S9tVjwzPT3-KtKiNUV8CeFVebb</a>.
</div>
<div id="ref-uelectronics_vibration_motor" class="csl-entry" role="listitem">
uElectronics. 2024. <span>«Motor de Vibración 5V»</span>. <a href="https://uelectronics.com/producto/motor-vibracion-5v/?srsltid=AfmBOoobMBx68FsKl3OQeHRxlqV72c0WFDIICCubVzyQFrHrNYflB-w4">https://uelectronics.com/producto/motor-vibracion-5v/?srsltid=AfmBOoobMBx68FsKl3OQeHRxlqV72c0WFDIICCubVzyQFrHrNYflB-w4</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiado");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiado");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../Capitulos/confort_termico.html" class="pagination-link" aria-label="Marco teórico">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Marco teórico</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../Capitulos/resultados.html" class="pagination-link" aria-label="Conclusiones">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Conclusiones</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>